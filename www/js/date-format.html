<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>CrossKnowledge - Code challenge</title>
    </head>
    <body>
        <script>
            // This will create elements for testing, DO NOT change this code
            (() => {
                const MS_PER_MINUTE = 60000
                const NOW = new Date()
                let minutes = [0, 1, 30, 60, 6 * 60, 23 * 60, 24 * 60]
                let dates = []

                minutes.forEach((i) => dates.push(new Date(NOW - i * MS_PER_MINUTE)))

                dates.forEach((item) => {
                    let el = document.createElement("div")
                    el.innerHTML = "Started "

                    let dt = document.createElement('span')
                    dt.className = 'js-date-format'
                    dt.innerHTML = item.toISOString()
                    el.appendChild(dt)
                    document.body.appendChild(el)
                })
            })();

            function getTime(time) {
                let seconds = Math.floor(time / 1000);
                let minutes = Math.floor(seconds / 60);
                let hours = Math.floor(minutes / 60);
                let days = Math.floor(hours / 24);

                return {
                    seconds: seconds,
                    minutes: minutes,
                    hours: hours,
                    days: days
                }
            }

            function generateText(now, previousDate) {
                let fullDate = null
                let value = 0;
                let timeUnit = ''

                let time = getTime(now - previousDate)

                if (time.days > 0) {
                    fullDate = previousDate.toISOString()
                } else if (time.hours > 0) {
                    value = time.hours
                    timeUnit = time.hours > 1 ? 'hours' : 'hour'
                } else if (time.minutes > 0) {
                    value = time.minutes
                    timeUnit = time.minutes > 1 ? 'minutes' : 'minute'
                } else if (time.seconds > 0) {
                    value = time.seconds
                    timeUnit = time.seconds > 1 ? 'seconds' : 'second'
                }

                return fullDate === null ? `${value} ${timeUnit} ago` : fullDate;
            }

            function handle() {
                let element = document.getElementsByClassName("js-date-format")
                let initialDates = []

                setInterval(() => {
                    let now = new Date()

                    Array.from(element).forEach((el, k) => {
                        if (initialDates[k] === undefined) {
                            initialDates.push(el.innerHTML)
                        }

                        let date = new Date(initialDates[k])

                        el.firstChild.nodeValue = generateText(now, date)
                    });
                }, 1000)
            }

            handle()
        </script>
    </body>
</html>